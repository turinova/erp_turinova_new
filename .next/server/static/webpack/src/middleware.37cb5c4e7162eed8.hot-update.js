"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/permissions-server.ts":
/*!***************************************!*\
  !*** ./src/lib/permissions-server.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getAllPages: () => (/* binding */ getAllPages),\n/* harmony export */   getAllUserPermissions: () => (/* binding */ getAllUserPermissions),\n/* harmony export */   getAllUsersWithPermissions: () => (/* binding */ getAllUsersWithPermissions),\n/* harmony export */   getUserPermissionsFromDB: () => (/* binding */ getUserPermissionsFromDB),\n/* harmony export */   hasPagePermission: () => (/* binding */ hasPagePermission),\n/* harmony export */   updateUserPermission: () => (/* binding */ updateUserPermission)\n/* harmony export */ });\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(middleware)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n// Server-side Permission System Utilities\n// For use in middleware and API routes only\n\n\n/**\n * Get user permissions from database (server-side only)\n */ async function getUserPermissionsFromDB(userId) {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://xgkaviefifbllbmfbyfe.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhna2F2aWVmaWZibGxibWZieWZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDYxNTEsImV4cCI6MjA3MjcyMjE1MX0.EQFv5-iHscXMhU73oV7f90xmB8g8gr3YJ_-4ROQJ-AY\", {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            },\n            setAll (cookiesToSet) {\n                cookiesToSet.forEach(({ name, value, options })=>cookieStore.set(name, value, options));\n            }\n        }\n    });\n    const { data, error } = await supabase.rpc('get_user_permissions', {\n        user_uuid: userId\n    });\n    if (error) {\n        console.error('Error fetching user permissions:', error);\n        // Fail-closed: return empty permissions (deny access)\n        return [];\n    }\n    return data || [];\n}\n/**\n * Check if user has permission to access a specific page (server-side)\n */ async function hasPagePermission(userId, pagePath, sessionPermissions) {\n    try {\n        // Handle dynamic routes: /orders/[id] should check /orders\n        const basePath = pagePath.split('/').slice(0, 2).join('/'); // e.g., /orders/123 -> /orders\n        const checkPath = basePath.length > 1 ? basePath : pagePath; // If basePath is just '/', use original path\n        console.log(`Permission check: ${pagePath} -> ${checkPath}`);\n        // If permissions are provided (from session cache), use them\n        if (sessionPermissions) {\n            const permission = sessionPermissions.find((p)=>p.page_path === checkPath);\n            return permission?.can_access ?? false;\n        }\n        // Fallback to database check\n        const permissions = await getUserPermissionsFromDB(userId);\n        const permission = permissions.find((p)=>p.page_path === checkPath);\n        return permission?.can_access ?? false;\n    } catch (error) {\n        console.error('Error checking page permission:', error);\n        // Fail-closed: deny access on error\n        return false;\n    }\n}\n/**\n * Get all permissions for a user (server-side)\n */ async function getAllUserPermissions(userId) {\n    return await getUserPermissionsFromDB(userId);\n}\n/**\n * Update user permission in database (server-side)\n */ async function updateUserPermission(userId, pagePath, canAccess) {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://xgkaviefifbllbmfbyfe.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhna2F2aWVmaWZibGxibWZieWZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDYxNTEsImV4cCI6MjA3MjcyMjE1MX0.EQFv5-iHscXMhU73oV7f90xmB8g8gr3YJ_-4ROQJ-AY\", {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            }\n        }\n    });\n    // First get the page ID\n    const { data: page, error: pageError } = await supabase.from('pages').select('id').eq('path', pagePath).eq('is_active', true).single();\n    if (pageError || !page) {\n        console.error('Error finding page:', pageError);\n        return false;\n    }\n    // Update or insert permission\n    const { error } = await supabase.from('user_permissions').upsert({\n        user_id: userId,\n        page_id: page.id,\n        can_access: canAccess\n    }, {\n        onConflict: 'user_id,page_id'\n    });\n    if (error) {\n        console.error('Error updating user permission:', error);\n        return false;\n    }\n    return true;\n}\n/**\n * Get all users with their permissions (server-side)\n */ async function getAllUsersWithPermissions() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://xgkaviefifbllbmfbyfe.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhna2F2aWVmaWZibGxibWZieWZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDYxNTEsImV4cCI6MjA3MjcyMjE1MX0.EQFv5-iHscXMhU73oV7f90xmB8g8gr3YJ_-4ROQJ-AY\", {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            }\n        }\n    });\n    // Get all users from the public users table\n    const { data: users, error: usersError } = await supabase.from('users').select('id, email, full_name, created_at, last_sign_in_at').order('created_at', {\n        ascending: false\n    });\n    if (usersError) {\n        console.error('Error fetching users:', usersError);\n        return [];\n    }\n    return users || [];\n}\n/**\n * Get all pages for permission management (server-side)\n */ async function getAllPages() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.cookies)();\n    const supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createServerClient)(\"https://xgkaviefifbllbmfbyfe.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhna2F2aWVmaWZibGxibWZieWZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcxNDYxNTEsImV4cCI6MjA3MjcyMjE1MX0.EQFv5-iHscXMhU73oV7f90xmB8g8gr3YJ_-4ROQJ-AY\", {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            }\n        }\n    });\n    const { data: pages, error } = await supabase.from('pages').select('*').eq('is_active', true).order('category', {\n        ascending: true\n    }).order('name', {\n        ascending: true\n    });\n    if (error) {\n        console.error('Error fetching pages:', error);\n        return [];\n    }\n    return pages || [];\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9wZXJtaXNzaW9ucy1zZXJ2ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQSwwQ0FBMEM7QUFDMUMsNENBQTRDO0FBRU07QUFDWjtBQUd0Qzs7Q0FFQyxHQUNNLGVBQWVFLHlCQUF5QkMsTUFBYztJQUMzRCxNQUFNQyxjQUFjLE1BQU1ILHFEQUFPQTtJQUNqQyxNQUFNSSxXQUFXTCxpRUFBa0JBLENBQ2pDTSwwQ0FBb0MsRUFDcENBLGtOQUF5QyxFQUN6QztRQUNFTCxTQUFTO1lBQ1BTLEtBQUlDLElBQVk7Z0JBQ2QsT0FBT1AsWUFBWU0sR0FBRyxDQUFDQyxPQUFPQztZQUNoQztZQUNBQyxRQUFPQyxZQUFZO2dCQUNqQkEsYUFBYUMsT0FBTyxDQUFDLENBQUMsRUFBRUosSUFBSSxFQUFFQyxLQUFLLEVBQUVJLE9BQU8sRUFBRSxHQUFLWixZQUFZYSxHQUFHLENBQUNOLE1BQU1DLE9BQU9JO1lBQ2xGO1FBQ0Y7SUFDRjtJQUdGLE1BQU0sRUFBRUUsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNZCxTQUFTZSxHQUFHLENBQUMsd0JBQXdCO1FBQ2pFQyxXQUFXbEI7SUFDYjtJQUVBLElBQUlnQixPQUFPO1FBQ1RHLFFBQVFILEtBQUssQ0FBQyxvQ0FBb0NBO1FBQ2xELHNEQUFzRDtRQUN0RCxPQUFPLEVBQUU7SUFDWDtJQUVBLE9BQU9ELFFBQVEsRUFBRTtBQUNuQjtBQUVBOztDQUVDLEdBQ00sZUFBZUssa0JBQ3BCcEIsTUFBYyxFQUNkcUIsUUFBZ0IsRUFDaEJDLGtCQUFxQztJQUVyQyxJQUFJO1FBQ0YsMkRBQTJEO1FBQzNELE1BQU1DLFdBQVdGLFNBQVNHLEtBQUssQ0FBQyxLQUFLQyxLQUFLLENBQUMsR0FBRyxHQUFHQyxJQUFJLENBQUMsTUFBTSwrQkFBK0I7UUFDM0YsTUFBTUMsWUFBWUosU0FBU0ssTUFBTSxHQUFHLElBQUlMLFdBQVdGLFVBQVUsNkNBQTZDO1FBRTFHRixRQUFRVSxHQUFHLENB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SUFDRjtJQUdGLE1BQU0sRUFBRU0sTUFBTXlDLEtBQUssRUFBRXhDLEtBQUssRUFBRSxHQUFHLE1BQU1kLFNBQ2xDdUMsSUFBSSxDQUFDLFNBQ0xDLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsYUFBYSxNQUNoQlUsS0FBSyxDQUFDLFlBQVk7UUFBRUMsV0FBVztJQUFLLEdBQ3BDRCxLQUFLLENBQUMsUUFBUTtRQUFFQyxXQUFXO0lBQUs7SUFFbkMsSUFBSXRDLE9BQU87UUFDVEcsUUFBUUgsS0FBSyxDQUFDLHlCQUF5QkE7UUFDdkMsT0FBTyxFQUFFO0lBQ1g7SUFFQSxPQUFPd0MsU0FBUyxFQUFFO0FBQ3BCIiwic291cmNlcyI6WyIvVm9sdW1lcy9UNy9lcnBfdHVyaW5vdmFfbmV3L3NyYy9saWIvcGVybWlzc2lvbnMtc2VydmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFNlcnZlci1zaWRlIFBlcm1pc3Npb24gU3lzdGVtIFV0aWxpdGllc1xuLy8gRm9yIHVzZSBpbiBtaWRkbGV3YXJlIGFuZCBBUEkgcm91dGVzIG9ubHlcblxuaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3NzcidcbmltcG9ydCB7IGNvb2tpZXMgfSBmcm9tICduZXh0L2hlYWRlcnMnXG5pbXBvcnQgeyBVc2VyUGVybWlzc2lvbiB9IGZyb20gJy4vcGVybWlzc2lvbnMnXG5cbi8qKlxuICogR2V0IHVzZXIgcGVybWlzc2lvbnMgZnJvbSBkYXRhYmFzZSAoc2VydmVyLXNpZGUgb25seSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJQZXJtaXNzaW9uc0Zyb21EQih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlclBlcm1pc3Npb25bXT4ge1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICB7XG4gICAgICBjb29raWVzOiB7XG4gICAgICAgIGdldChuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0KG5hbWUpPy52YWx1ZVxuICAgICAgICB9LFxuICAgICAgICBzZXRBbGwoY29va2llc1RvU2V0KSB7XG4gICAgICAgICAgY29va2llc1RvU2V0LmZvckVhY2goKHsgbmFtZSwgdmFsdWUsIG9wdGlvbnMgfSkgPT4gY29va2llU3RvcmUuc2V0KG5hbWUsIHZhbHVlLCBvcHRpb25zKSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH1cbiAgKVxuXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLnJwYygnZ2V0X3VzZXJfcGVybWlzc2lvbnMnLCB7XG4gICAgdXNlcl91dWlkOiB1c2VySWRcbiAgfSlcblxuICBpZiAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1c2VyIHBlcm1pc3Npb25zOicsIGVycm9yKVxuICAgIC8vIEZhaWwtY2xvc2VkOiByZXR1cm4gZW1wdHkgcGVybWlzc2lvbnMgKGRlbnkgYWNjZXNzKVxuICAgIHJldHVybiBbXVxuICB9XG5cbiAgcmV0dXJuIGRhdGEgfHwgW11cbn1cblxuLyoqXG4gKiBDaGVjayBpZiB1c2VyIGhhcyBwZXJtaXNzaW9uIHRvIGFjY2VzcyBhIHNwZWNpZmljIHBhZ2UgKHNlcnZlci1zaWRlKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzUGFnZVBlcm1pc3Npb24oXG4gIHVzZXJJZDogc3RyaW5nLCBcbiAgcGFnZVBhdGg6IHN0cmluZywgXG4gIHNlc3Npb25QZXJtaXNzaW9ucz86IFVzZXJQZXJtaXNzaW9uW11cbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIC8vIEhhbmRsZSBkeW5hbWljIHJvdXRlczogL29yZGVycy9baWRdIHNob3VsZCBjaGVjayAvb3JkZXJzXG4gICAgY29uc3QgYmFzZVBhdGggPSBwYWdlUGF0aC5zcGxpdCgnLycpLnNsaWNlKDAsIDIpLmpvaW4oJy8nKTsgLy8gZS5nLiwgL29yZGVycy8xMjMgLT4gL29yZGVyc1xuICAgIGNvbnN0IGNoZWNrUGF0aCA9IGJhc2VQYXRoLmxlbmd0aCA+IDEgPyBiYXNlUGF0aCA6IHBhZ2VQYXRoOyAvLyBJZiBiYXNlUGF0aCBpcyBqdXN0ICcvJywgdXNlIG9yaWdpbmFsIHBhdGhcblxuICAgIGNvbnNvbGUubG9nKGBQZXJtaXNzaW9uIGNoZWNrOiAke3BhZ2VQYXRofSAtPiAke2NoZWNrUGF0aH1gKVxuXG4gICAgLy8gSWYgcGVybWlzc2lvbnMgYXJlIHByb3ZpZGVkIChmcm9tIHNlc3Npb24gY2FjaGUpLCB1c2UgdGhlbVxuICAgIGlmIChzZXNzaW9uUGVybWlzc2lvbnMpIHtcbiAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBzZXNzaW9uUGVybWlzc2lvbnMuZmluZChwID0+IHAucGFnZV9wYXRoID09PSBjaGVja1BhdGgpXG4gICAgICByZXR1cm4gcGVybWlzc2lvbj8uY2FuX2FjY2VzcyA/PyBmYWxzZVxuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIGRhdGFiYXNlIGNoZWNrXG4gICAgY29uc3QgcGVybWlzc2lvbnMgPSBhd2FpdCBnZXRVc2VyUGVybWlzc2lvbnNGcm9tREIodXNlcklkKVxuICAgIGNvbnN0IHBlcm1pc3Npb24gPSBwZXJtaXNzaW9ucy5maW5kKHAgPT4gcC5wYWdlX3BhdGggPT09IGNoZWNrUGF0aClcbiAgICByZXR1cm4gcGVybWlzc2lvbj8uY2FuX2FjY2VzcyA/PyBmYWxzZVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIHBhZ2UgcGVybWlzc2lvbjonLCBlcnJvcilcbiAgICAvLyBGYWlsLWNsb3NlZDogZGVueSBhY2Nlc3Mgb24gZXJyb3JcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxufVxuXG4vKipcbiAqIEdldCBhbGwgcGVybWlzc2lvbnMgZm9yIGEgdXNlciAoc2VydmVyLXNpZGUpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxVc2VyUGVybWlzc2lvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJQZXJtaXNzaW9uW10+IHtcbiAgcmV0dXJuIGF3YWl0IGdldFVzZXJQZXJtaXNzaW9uc0Zyb21EQih1c2VySWQpXG59XG5cbi8qKlxuICogVXBkYXRlIHVzZXIgcGVybWlzc2lvbiBpbiBkYXRhYmFzZSAoc2VydmVyLXNpZGUpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyUGVybWlzc2lvbihcbiAgdXNlcklkOiBzdHJpbmcsIFxuICBwYWdlUGF0aDogc3RyaW5nLCBcbiAgY2FuQWNjZXNzOiBib29sZWFuXG4pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAge1xuICAgICAgY29va2llczoge1xuICAgICAgICBnZXQobmFtZTogc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvb2tpZVN0b3JlLmdldChuYW1lKT8udmFsdWVcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuICApXG5cbiAgLy8gRmlyc3QgZ2V0IHRoZSBwYWdlIElEXG4gIGNvbnN0IHsgZGF0YTogcGFnZSwgZXJyb3I6IHBhZ2VFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgncGFnZXMnKVxuICAgIC5zZWxlY3QoJ2lkJylcbiAgICAuZXEoJ3BhdGgnLCBwYWdlUGF0aClcbiAgICAuZXEoJ2lzX2FjdGl2ZScsIHRydWUpXG4gICAgLnNpbmdsZSgpXG5cbiAgaWYgKHBhZ2VFcnJvciB8fCAhcGFnZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZpbmRpbmcgcGFnZTonLCBwYWdlRXJyb3IpXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBVcGRhdGUgb3IgaW5zZXJ0IHBlcm1pc3Npb25cbiAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgndXNlcl9wZXJtaXNzaW9ucycpXG4gICAgLnVwc2VydCh7XG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBwYWdlX2lkOiBwYWdlLmlkLFxuICAgICAgY2FuX2FjY2VzczogY2FuQWNjZXNzXG4gICAgfSwge1xuICAgICAgb25Db25mbGljdDogJ3VzZXJfaWQscGFnZV9pZCdcbiAgICB9KVxuXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHVzZXIgcGVybWlzc2lvbjonLCBlcnJvcilcbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHJldHVybiB0cnVlXG59XG5cbi8qKlxuICogR2V0IGFsbCB1c2VycyB3aXRoIHRoZWlyIHBlcm1pc3Npb25zIChzZXJ2ZXItc2lkZSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFsbFVzZXJzV2l0aFBlcm1pc3Npb25zKCk6IFByb21pc2U8YW55W10+IHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMISxcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAge1xuICAgICAgY29va2llczoge1xuICAgICAgICBnZXQobmFtZTogc3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuIGNvb2tpZVN0b3JlLmdldChuYW1lKT8udmFsdWVcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfVxuICApXG5cbiAgLy8gR2V0IGFsbCB1c2VycyBmcm9tIHRoZSBwdWJsaWMgdXNlcnMgdGFibGVcbiAgY29uc3QgeyBkYXRhOiB1c2VycywgZXJyb3I6IHVzZXJzRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oJ3VzZXJzJylcbiAgICAuc2VsZWN0KCdpZCwgZW1haWwsIGZ1bGxfbmFtZSwgY3JlYXRlZF9hdCwgbGFzdF9zaWduX2luX2F0JylcbiAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcblxuICBpZiAodXNlcnNFcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHVzZXJzOicsIHVzZXJzRXJyb3IpXG4gICAgcmV0dXJuIFtdXG4gIH1cblxuICByZXR1cm4gdXNlcnMgfHwgW11cbn1cblxuLyoqXG4gKiBHZXQgYWxsIHBhZ2VzIGZvciBwZXJtaXNzaW9uIG1hbmFnZW1lbnQgKHNlcnZlci1zaWRlKVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QWxsUGFnZXMoKTogUHJvbWlzZTxhbnlbXT4ge1xuICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudChcbiAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhLFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZISxcbiAgICB7XG4gICAgICBjb29raWVzOiB7XG4gICAgICAgIGdldChuYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgICByZXR1cm4gY29va2llU3RvcmUuZ2V0KG5hbWUpPy52YWx1ZVxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9XG4gIClcblxuICBjb25zdCB7IGRhdGE6IHBhZ2VzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAuZnJvbSgncGFnZXMnKVxuICAgIC5zZWxlY3QoJyonKVxuICAgIC5lcSgnaXNfYWN0aXZlJywgdHJ1ZSlcbiAgICAub3JkZXIoJ2NhdGVnb3J5JywgeyBhc2NlbmRpbmc6IHRydWUgfSlcbiAgICAub3JkZXIoJ25hbWUnLCB7IGFzY2VuZGluZzogdHJ1ZSB9KVxuXG4gIGlmIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIHBhZ2VzOicsIGVycm9yKVxuICAgIHJldHVybiBbXVxuICB9XG5cbiAgcmV0dXJuIHBhZ2VzIHx8IFtdXG59XG4iXSwibmFtZXMiOlsiY3JlYXRlU2VydmVyQ2xpZW50IiwiY29va2llcyIsImdldFVzZXJQZXJtaXNzaW9uc0Zyb21EQiIsInVzZXJJZCIsImNvb2tpZVN0b3JlIiwic3VwYWJhc2UiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJnZXQiLCJuYW1lIiwidmFsdWUiLCJzZXRBbGwiLCJjb29raWVzVG9TZXQiLCJmb3JFYWNoIiwib3B0aW9ucyIsInNldCIsImRhdGEiLCJlcnJvciIsInJwYyIsInVzZXJfdXVpZCIsImNvbnNvbGUiLCJoYXNQYWdlUGVybWlzc2lvbiIsInBhZ2VQYXRoIiwic2Vzc2lvblBlcm1pc3Npb25zIiwiYmFzZVBhdGgiLCJzcGxpdCIsInNsaWNlIiwiam9pbiIsImNoZWNrUGF0aCIsImxlbmd0aCIsImxvZyIsInBlcm1pc3Npb24iLCJmaW5kIiwicCIsInBhZ2VfcGF0aCIsImNhbl9hY2Nlc3MiLCJwZXJtaXNzaW9ucyIsImdldEFsbFVzZXJQZXJtaXNzaW9ucyIsInVwZGF0ZVVzZXJQZXJtaXNzaW9uIiwiY2FuQWNjZXNzIiwicGFnZSIsInBhZ2VFcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsInVwc2VydCIsInVzZXJfaWQiLCJwYWdlX2lkIiwiaWQiLCJvbkNvbmZsaWN0IiwiZ2V0QWxsVXNlcnNXaXRoUGVybWlzc2lvbnMiLCJ1c2VycyIsInVzZXJzRXJyb3IiLCJvcmRlciIsImFzY2VuZGluZyIsImdldEFsbFBhZ2VzIiwicGFnZXMiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/permissions-server.ts\n");

/***/ })

});